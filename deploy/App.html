<!DOCTYPE html>
<html>
<head>
    <title>defect-trend</title>

    <script type="text/javascript" src="/apps/2.0rc1/sdk.js"></script>
    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0rc1/lib/analytics/analytics-all.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",launch:function(){this._getChartData()},_getChartData:function(){Ext.create("Rally.data.lookback.SnapshotStore",{listeners:{load:this._onDefectsLoaded},fetch:["Name","Severity"],autoLoad:!0,context:{workspace:"/workspace/41529001",project:"/project/279050021",projectScopeUp:!1,projectScopeDown:!0},hydrate:["Severity"],filters:[{property:"_TypeHierarchy",operator:"in",value:["Defect"]},{property:"Severity",operator:"in",value:["Minor Problem","Major Problem","Cosmetic"]},{property:"Project",operator:"in",value:[279050021]}],scope:this})},_onDefectsLoaded:function(store,data,success){var that=this,lumenize=window.parent.Rally.data.lookback.Lumenize,snapShotData=_.map(data,function(d){return d.data});console.log("snapshot count:",data.length);var holidays=[{year:2014,month:1,day:1}],metrics=[{as:"defectMajor",f:"filteredCount",filterField:"Severity",filterValues:["Major Problem"]},{as:"defectMinor",f:"filteredCount",filterField:"Severity",filterValues:["Minor Problem"]},{as:"defectCosmetic",f:"filteredCount",filterField:"Severity",filterValues:["Cosmetic"]}],summaryMetricsConfig=[],derivedFieldsAfterSummary=[],deriveFieldsOnInput=[],config={metrics:metrics,granularity:lumenize.Time.DAY,tz:"America/Chicago",holidays:holidays,workDays:"Monday,Tuesday,Wednesday,Thursday,Friday",summaryMetricsConfig:summaryMetricsConfig,deriveFieldsAfterSummary:derivedFieldsAfterSummary,deriveFieldsOnInput:deriveFieldsOnInput},startOnISOString=new lumenize.Time("2013-01-01").getISOStringInTZ(config.tz),upToDateISOString=new lumenize.Time("2013-09-01").getISOStringInTZ(config.tz);calculator=new lumenize.TimeSeriesCalculator(config),calculator.addSnapshots(snapShotData,startOnISOString,upToDateISOString);var hcConfig=[{name:"label"},{name:"defectMajor"},{name:"defectMinor"},{name:"defectCosmetic"}],hcData=lumenize.arrayOfMaps_To_HighChartsSeries(calculator.getResults().seriesData,hcConfig);console.log("hc: ",hcData);var myChart=Ext.create("Rally.ui.chart.Chart",{chartConfig:this._getChartConfiguration(),chartData:hcData});this.add(myChart)},_getChartConfiguration:function(){return{chart:{type:"area"},title:{text:"Historic and Estimated Worldwide Population Growth by Region"},subtitle:{text:"Source: Wikipedia.org"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e of %b"}},yAxis:{title:{text:"Count"},labels:{formatter:function(){return this.value}}},tooltip:{shared:!0,valueSuffix:" millions"},plotOptions:{area:{stacking:"normal",lineColor:"#666666",lineWidth:1,marker:{lineWidth:1,lineColor:"#666666"}}}}}});

            Rally.launchApp('CustomApp', {
                name:"defect-trend",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
